<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="../images/logo.png" />
    <link rel="stylesheet" href="../styles/main.css" />
    <title>All Blogs | Dashboard | Shema's Blog</title>
  </head>
  <body>
    <header class="navigation" id="home">
      <nav class="container py-4">
        <div class="logo">
          <h1 class="m-0">/ Fred /</h1>
        </div>
        <div class="toggle">
          <div class="line"></div>
          <div class="line"></div>
          <div class="line"></div>
        </div>
        <ul class="nav-links">
          <li class="nav-link"><a href="dashboard.html">Dashboard</a></li>
          <li class="nav-link"><a href="../index.html">Logout</a></li>
        </ul>
      </nav>
    </header>
    <section id="body-content">
      <div class="container py-5">
        <div class="row align-items-center">
          <div class="col">
            <h1 class="text-lg mt-0 mb-3">All Blogs</h1>
            <p class="my-0">Manage your blogs</p>
          </div>
          <div class="col-auto">
            <a href="add-blog.html" class="btn">Add Blog</a>
          </div>
        </div>

        <div class="table-container mt-4">
          <table class="table">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th class="text-center">Reads</th>
                <th class="text-center">Likes</th>
                <th class="text-center">Comments</th>
                <th>Created At</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
      </div>
    </section>
    <script src="../scripts/responsive.js"></script>
    <script>
      window.addEventListener("load", function(){
        const articles = JSON.parse(localStorage.getItem("articles")) || []

        const deleteArticle = (index) => {
          const confirm = alert(`Are you sure you want to delete '${articles[index].title}'?`);
          if(confirm){
            articles.splice(index, 1)
            localStorage.setItem("articles", JSON.stringify(articles))
            location.reload()
          }
        }

        const tableBody = document.querySelector("tbody")

        if(articles.length === 0){
          tableBody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center py-5">No articles found</td>
            </tr>
          `
        }else{
        articles.forEach((article, index) => {
          const row = document.createElement("tr")

          const actions = document.createElement("td")
          
          const editBtn = document.createElement("a")
          editBtn.href = "edit-blog.html?article=" + article.id
          editBtn.innerText = "Edit"
          editBtn.classList.add("mr-1", "btn", "btn-xs", "btn-secondary")

          const deleteBtn = document.createElement("a")
          deleteBtn.href = "#"
          deleteBtn.innerText = "Delete"
          deleteBtn.classList.add("btn", "btn-xs", "btn-danger")
          deleteBtn.addEventListener("click", () => deleteArticle(index))

          actions.appendChild(editBtn)
          actions.appendChild(deleteBtn)

          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${article.title}</td>
            <td class="text-center">${article.reads}</td>
            <td class="text-center">${article.likes}</td>
            <td class="text-center">${article.comments}</td>
            <td>${article.createdAt}</td>
          `
          row.appendChild(actions)
          tableBody.appendChild(row)
        });
      }
      });
    </script>
  </body>
</html>
